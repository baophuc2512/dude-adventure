<!DOCTYPE html>
<html>

<head>
    <script src="https://cdn.jsdelivr.net/npm/phaser@3.16.2/dist/phaser.min.js"></script>
</head>

<body>

    <script>
        const gameState = {
            amountBullet: 5,
            keyInventory: 1, //0: pause, 1: play
            keyBoss1: 1, //1: play ,0: pause
        };
        gameState.saveBullet = gameState.amountBullet;
        var keyMove = 1; // 0: pause, 1: play
        var lastFired = 0;
        var playerOldX = 0;
        var bossOldX = 0;
        var bossOldY = 0;
        var i = 1;
        class Inventory extends Phaser.Scene {
        constructor() { 
            super({ key: 'Inventory' })
        }
        preload() {
            this.load.image('dudeface','dudeface.png');
        }
        create() {
        //Tao Khung
            this.add.rectangle(0, 400, 1600, 400, 0xFA5C5C);
            this.add.rectangle(0, 100, 2000, 200, 0x008BFF);
            this.add.rectangle(1800, 400, 2000, 400, 0x0fff0f);
            this.add.rectangle(350 , 120, 200, 10, 0xffffff);
        //Picture dude
            this.add.circle(50 + 50, 50 + 50, 100, 0xff00ff);
            this.add.image(100, 100, 'dudeface').setScale(3);
        //Text
            this.add.text(250, 50, 'Player Name',{font:'40px Times New Roman'});
            //Stat
            this.add.text(600, 20, 'Health: \n(update soon)',{font:'30px Times New Roman'});
            this.add.text(600, 90, 'Stamina: \n (update soon)',{font:'30px Times New Roman'});
            //Score
            this.add.text(800, 200, 'Score: \n(update soon)',{font:'30px Times New Roman'});
            //Inventory
            this.add.text(50, 200, 'Inventory:',{font:'40px Times New Roman'});
            gameState.ammoText = this.add.text(50, 250, 'Pistol: 0 (Ammo)',{font:'25px Times New Roman'});
            gameState.ammoText.setText(`Pistol: ${gameState.amountBullet} (Ammo)`);
        //Close Button
            gameState.closeButtonCircle = this.add.rectangle(970, 30, 60, 60, '#050505');
            gameState.closeButton = this.add.rectangle(970, 30, 50, 50, 0xff0000);
            this.add.text(955, 10, 'X',{font:'40px Times New Roman'}); 
            gameState.closeButton.setInteractive();
        //Close 
            gameState.closeButton.on('pointerout', () => {
                gameState.closeButtonCircle.fillColor = "#050505";
            });
            gameState.closeButton.on('pointerover', () => {
                gameState.closeButtonCircle.fillColor = 0x2FFF00;
            });
            gameState.closeButton.on('pointerup', () => {
                gameState.keyInventory = 1;
                this.scene.stop('Inventory');
                this.scene.start('Level1');
            });
            }
        }
    class Level1 extends Phaser.Scene {
        constructor() { 
            super({ key: 'Level1' })
        }

        
        preload() {
            this.load.spritesheet('dude', 'dude.png', {
                frameWidth: 32,
                frameHeight: 48
            });
            this.load.spritesheet('slime', 'topdown_shooter/topdown_shooter/monster/slime1_front.png', {
                frameWidth: 16,
                frameHeight: 16
            });
            this.load.image('platform', 'https://s3.amazonaws.com/codecademy-content/courses/learn-phaser/Cave+Crisis/platform.png');
            this.load.image('sky', 'Final/Assets/Background_2.png');
            this.load.image('bg1', 'https://s3.amazonaws.com/codecademy-content/courses/learn-phaser/Codey+Tundra/trees.png');
            this.load.image('bg2', 'https://s3.amazonaws.com/codecademy-content/courses/learn-phaser/Codey+Tundra/snowdunes.png');
            this.load.image('bullet', 'topdown_shooter/topdown_shooter/other/bulletc.png');
            this.load.image('spike', 'Spike.png');
            this.load.image('mountain', 'Glacial-mountains-parallax-background_vnitti_v3/Glacial-mountains-parallax-background_vnitti/Layers/glacial_mountains_lightened.png');
            this.load.image('platform2', 'platform2.png');
            this.load.image('endpoint', 'End.png');
            this.load.image('ammo', 'ammo.png');
        }

        create() {
            //BackGround
            this.add.image(0, 0, 'sky').setOrigin(0, 0).setScale(5);
            this.add.image(0, -400, 'mountain').setOrigin(0, 0).setScale(6);
            this.add.image(0, 0, 'bg1').setOrigin(0, 0);
            this.add.image(1300, 0, 'bg1').setOrigin(0, 0);
            this.add.image(0, 0, 'bg2').setOrigin(0, 0);


            //Platform
            const platform = this.physics.add.staticGroup();
            platform.create(100, 575, 'platform');
            platform.create(300, 575, 'platform');
            platform.create(500, 575, 'platform');
            platform.create(700, 575, 'platform');
            platform.create(900, 575, 'platform');
            platform.create(1100, 575, 'platform');
            platform.create(1300, 575, 'platform');
            platform.create(1500, 575, 'platform');
            platform.create(1700, 575, 'platform');
            platform.create(1900, 575, 'platform'); 

            platform.create(1700, 275, 'platform');
            platform.create(1400, 275, 'platform');
            platform.create(1100, 275, 'platform');
            platform.create(800, 275, 'platform');
            platform.create(400, 275, 'platform');
            platform.create(100, 275, 'platform');

            //Platform2
            const platform2 = this.physics.add.staticGroup();
            platform2.create(900, 500 -20,'platform2');
            platform2.create(850, 480 -20,'platform2');
            platform2.create(800, 460 -20,'platform2');
            platform2.create(750, 440 -20,'platform2');
            platform2.create(700, 420 -20,'platform2');
            platform2.create(650, 400 -20,'platform2');

            //Spike
            const spikes = this.physics.add.staticGroup();
            spikes.create(200, 575 - 32, 'spike').setScale(2);
            spikes.create(232, 575 - 32, 'spike').setScale(2);
            spikes.create(1300, 575 - 32, 'spike').setScale(2);
            spikes.create(1332, 575 - 32, 'spike').setScale(2);
            spikes.create(1364, 575 - 32, 'spike').setScale(2);
            spikes.create(1396, 575 - 32, 'spike').setScale(2);
            spikes.create(1428, 575 - 32, 'spike').setScale(2);
            spikes.create(1460, 575 - 32, 'spike').setScale(2);
            spikes.create(1492, 575 - 32, 'spike').setScale(2);
            spikes.create(1524, 575 - 32, 'spike').setScale(2);
            spikes.create(1556, 575 - 32, 'spike').setScale(2);
            spikes.create(1588, 575 - 32, 'spike').setScale(2);
            spikes.create(1620, 575 - 32, 'spike').setScale(2);
            spikes.create(1652, 575 - 32, 'spike').setScale(2);
            spikes.create(1684, 575 - 32, 'spike').setScale(2);
            spikes.create(1716, 575 - 32, 'spike').setScale(2);
            spikes.create(1748, 575 - 32, 'spike').setScale(2);
            spikes.create(1780, 575 - 32, 'spike').setScale(2);
            spikes.create(1812, 575 - 32, 'spike').setScale(2);
            spikes.create(1844, 575 - 32, 'spike').setScale(2);
            spikes.create(1876, 575 - 32, 'spike').setScale(2);
            spikes.create(1908, 575 - 32, 'spike').setScale(2);
            spikes.create(1940, 575 - 32, 'spike').setScale(2);

            spikes.create(400, 275 - 32, 'spike').setScale(2);
            spikes.create(800, 275 - 32, 'spike').setScale(2);
            spikes.create(832, 275 - 32, 'spike').setScale(2);
            spikes.create(800 - 32, 275 - 32, 'spike').setScale(2);
            spikes.create(1000 + 16, 275 - 32, 'spike').setScale(2);
            spikes.create(1200 - 16, 275 - 32, 'spike').setScale(2);
            spikes.create(1500 - 16, 275 - 32, 'spike').setScale(2);
            spikes.create(1600 + 36, 275 - 32, 'spike').setScale(2);

            //Bullet
            // Create 1 class bullet
            gameState.amountBullet = gameState.saveBullet;
            var Bullet = new Phaser.Class({

                Extends: Phaser.Physics.Arcade.Image,

                initialize:

                    function Bullet(scene) {
                        // Phaser.GameObjects.Image.call(this, scene, 0, 0, 'bullet');
                        Phaser.Physics.Arcade.Image.call(this, scene, 0, 0, 'bullet');

                        this.speed = Phaser.Math.GetSpeed(400, 1);
                    },

                fire: function (x, y, type) {
                    this.type = type;
                    gameState.amountBullet -= 1;
                    this.setPosition(x, y + 12);
                    playerOldX = x;
                    this.setActive(true);
                    this.setVisible(true);
                },

                update: function (time, delta) {
                    if (this.type === 'R') {
                        this.x += this.speed * delta;
                    } else if (this.type === 'L') {
                        this.x -= this.speed * delta;
                    }

                    if (this.x > playerOldX + 300 || this.x < playerOldX - 300) {
                        this.setActive(false);
                        this.setVisible(false);
                        this.x = 100000;
                    }
                }

            });

            gameState.bullets = this.physics.add.group({
                classType: Bullet,
                maxSize: 2,
                runChildUpdate: true
            });
            gameState.bullet = gameState.bullets.get();
            gameState.bullet.body.setAllowGravity(false);


            //Players
            gameState.player = this.physics.add.sprite(50, 500, 'dude');
            gameState.player.setBounce(0.2);

            this.cameras.main.startFollow(gameState.player, true, 0.5, 0.5);
            this.cameras.main.setBounds(0, 0, 2000, 600);

            this.physics.add.collider(gameState.player, platform);
            this.physics.add.collider(gameState.player, platform2);
            this.physics.add.overlap(gameState.player, spikes, () => {
                this.add.text(gameState.player.x + 10, gameState.player.y - 40, 'Game Over...\n  Click to play again.', {
                    fontFamily: 'Arial',
                    fontSize: 36,
                    color: '#f00ff0'
                });
                gameState.player.setTint('0xff0000')
                this.physics.pause();
                this.anims.pauseAll();
                slime1Move.pause();
                slime2Move.pause();
                slime3Move.pause();
                this.input.on('pointerup', () => {
                    this.scene.restart();
                    this.anims.resumeAll();
                    keyMove = 1;
                    gameState.amountBullet = 0;
                });
                keyMove = 0;
            });
            gameState.player.setCollideWorldBounds(true);
            this.physics.world.setBounds(0, 0, 2000, 600);

            //Ammo
            let ammos1 = this.physics.add.sprite(100, 275 - 48, 'ammo');
            ammos1.body.setAllowGravity(false);

            this.physics.add.collider(gameState.player, ammos1, () => {
                ammos1.destroy();
                gameState.amountBullet += 6;
            });

            //Enemies
            let slimes1 = this.physics.add.sprite(300, 500, 'slime').setScale(3);
            let slimes2 = this.physics.add.sprite(475, 225, 'slime').setScale(1);
            let slimes3 = this.physics.add.sprite(1500 -25, 275 - 60, 'slime').setScale(2);

            this.physics.add.collider(slimes1, platform);
            this.physics.add.collider(slimes2, platform);
            this.physics.add.collider(slimes3, platform);



            //MoveSlimes
            var slime1Move = this.tweens.add({
                targets: slimes1,
                x: 700,
                duration: 3000,
                ease: 'Linear',
                repeat: -1,
                yoyo: true
            });

            var slime2Move = this.tweens.add({
                targets: slimes2,
                x: 320,
                duration: 1000,
                ease: 'Linear',
                repeat: -1,
                yoyo: true
            });

            var slime3Move = this.tweens.add({
                targets: slimes3,
                x: 1300 +25,
                duration: 700,
                ease: 'Linear',
                repeat: -1,
                yoyo: true
            });
            //TouchSlimes
            this.physics.add.overlap(slimes1, gameState.player, () => {
                this.add.text(gameState.player.x + 10, gameState.player.y - 40, 'Game Over...\n  Click to play again.', {
                    fontFamily: 'Arial',
                    fontSize: 36,
                    color: '#f00ff0'
                });
                gameState.player.setTint('0xff0000')
                this.physics.pause();
                this.anims.pauseAll();
                slime1Move.pause();
                slime2Move.pause();
                slime3Move.pause();
                this.input.on('pointerup', () => {
                    this.scene.restart();
                    this.anims.resumeAll();
                    keyMove = 1;
                    gameState.amountBullet = 0;
                });
                keyMove = 0;
            });

            this.physics.add.overlap(slimes1,gameState.bullets, () => {
                    slimes1.destroy();
            });

            this.physics.add.overlap(slimes2, gameState.player, () => {
                this.add.text(gameState.player.x + 10, gameState.player.y - 40, 'Game Over...\n  Click to play again.', {
                    fontFamily: 'Arial',
                    fontSize: 36,
                    color: '#f00ff0'
                });
                gameState.player.setTint('0xff0000')
                this.physics.pause();
                this.anims.pauseAll();
                slime1Move.pause();
                slime2Move.pause();
                slime3Move.pause();
                this.input.on('pointerup', () => {
                    this.scene.restart();
                    this.anims.resumeAll();
                    keyMove = 1;
                    gameState.amountBullet = 0;
                });
                keyMove = 0;
            });

            this.physics.add.overlap(slimes2, gameState.bullets, () => {
                slimes2.destroy();
            });

            this.physics.add.overlap(slimes3, gameState.player, () => {
                this.add.text(gameState.player.x + 10, gameState.player.y - 40, 'Game Over...\n  Click to play again.', {
                    fontFamily: 'Arial',
                    fontSize: 36,
                    color: '#f00ff0'
                });
                gameState.player.setTint('0xff0000')
                this.physics.pause();
                this.anims.pauseAll();
                slime1Move.pause();
                slime2Move.pause();
                slime3Move.pause();
                this.input.on('pointerup', () => {
                    this.scene.restart();
                    this.anims.resumeAll();
                    keyMove = 1;
                    gameState.amountBullet = 0;
                });
                keyMove = 0;
            });

            this.physics.add.overlap(slimes3, gameState.bullets, () => {
                slimes3.destroy();
            });
            // createSnow

            // create animations
            this.anims.create({
                key: 'move',
                frames: this.anims.generateFrameNumbers('dude', {
                    start: 0,
                    end: 3
                }),
                frameRate: 10,
                repeat: -1
            });

            this.anims.create({
                key: 'idle',
                frames: [{
                    key: 'dude',
                    frame: 4
                }],
                frameRate: 20
            });

            

            //End Point
            let endPoint = this.physics.add.sprite(1964 + 18, 575 - 54, 'endpoint');
            endPoint.body.setAllowGravity(false);

            this.physics.add.overlap(gameState.player, endPoint, () => {
                this.add.text(gameState.player.x - 400, gameState.player.y - 40, 'Win Game...\n  Click to Continue.', {
                    fontFamily: 'Arial',
                    fontSize: 36,
                    color: '#f00ff0'
                });
                gameState.player.setTint('0xff0000')
                this.physics.pause();
                slime1Move.pause();
                slime2Move.pause();
                slime3Move.pause();
                gameState.player.setTint('0x2FFF00');
                gameState.saveBullet = gameState.amountBullet;
                this.input.on('pointerdown', () => {
			        this.scene.stop('Level1')
                    this.scene.start('Level2')
		        })
            });
            
        }

        

        update(time) {
            var cursors = this.input.keyboard.createCursorKeys();
            if (keyMove === 1) {
                if (cursors.left.isDown) {
                    gameState.player.setVelocityX(-200);
                    gameState.player.anims.play('move', true);
                    gameState.player.flipX = false;
                } else if (cursors.right.isDown) {
                    gameState.player.setVelocityX(200);
                    gameState.player.anims.play('move', true);
                    gameState.player.flipX = true;
                } else {
                    gameState.player.setVelocityX(0);
                    gameState.player.anims.play('idle', true);
                }

                // Jump
                if (cursors.up.isDown && gameState.player.body.touching.down) {
                    gameState.player.setVelocityY(-500);
                }

                // Shoot
                if (cursors.space.isDown && time > lastFired && cursors.right.isDown && gameState.amountBullet >0) {
                
                    gameState.bullet = gameState.bullets.get();

                    if (gameState.bullet !== null) {
                        gameState.bullet.body.setAllowGravity(false);

                        if (gameState.bullet) {
                            gameState.bullet.fire(gameState.player.x, gameState.player.y, 'R');

                            lastFired = time + 50;
                        }
                    };
                };

                if (cursors.space.isDown && time > lastFired && cursors.left.isDown && gameState.amountBullet > 0) {
                    
                    gameState.bullet = gameState.bullets.get();

                    if (gameState.bullet !== null) {
                        gameState.bullet.body.setAllowGravity(false);

                        if (gameState.bullet) {
                            gameState.bullet.fire(gameState.player.x, gameState.player.y, 'L');

                            lastFired = time + 50;
                        }
                    };
                };
                //Open Inventory
                gameState.keyOpenIn = this.input.keyboard.addKey('E');
                
                    gameState.keyOpenIn.on('down', () => {
                        if (gameState.keyInventory === 1) {
                            gameState.keyInventory = 0;
                            this.scene.start('Inventory');
                        }
                    });
            }
            
        }
        
    }
    var ammo = gameState.amountBullet;
    class Level2 extends Phaser.Scene {
        constructor() {
            super({key :'Level2'})
        }
        preload() {
            
            this.load.spritesheet('dude', 'dude.png', {
                frameWidth: 32,
                frameHeight: 48
            });
            this.load.spritesheet('slime', 'topdown_shooter/topdown_shooter/monster/slime1_front.png', {
                frameWidth: 16,
                frameHeight: 16
            });
            this.load.image('platform', 'https://s3.amazonaws.com/codecademy-content/courses/learn-phaser/Cave+Crisis/platform.png');
            this.load.image('platform2', 'platform2.png');
            this.load.image('bullet', 'topdown_shooter/topdown_shooter/other/bulletc.png');
            this.load.image('spike', 'Spike.png');
            this.load.image('spike2', 'Spike2.png');
            this.load.image('spike3', 'Spike3.png');
            this.load.image('spike4', 'Spike4.png');
            this.load.image('endpoint', 'End.png');
            this.load.image('ammo', 'ammo.png');  
            this.load.image('cave', 'cave_background.png');
            this.load.spritesheet('Bat', 'Flight.png', {
                frameWidth: 50.5,
                frameHeight: 37
            });
        }

        create() {
            //BackGround
            this.add.image(0, 0, 'cave').setOrigin(0, 0).setScale(5);
            //Platform
            const platform = this.physics.add.staticGroup();
            platform.create(100, 675, 'platform');
            platform.create(500, 575, 'platform');
            platform.create(700, 575, 'platform');
            platform.create(900, 575, 'platform');
            platform.create(1300, 675, 'platform');
            platform.create(1500, 675, 'platform');
            platform.create(1900, 675, 'platform');
            platform.create(2300, 675, 'platform');
            platform.create(2500, 675, 'platform');
            platform.create(2700, 675, 'platform');

            //Platform2
            const platform2 = this.physics.add.staticGroup();
            var d1 = 36;
            var d2 = 57;
            var d3 = 78;
            var d4 = 99;
            var d5 = 120;
            platform2.create(100, 675 + d1, 'platform2');
            platform2.create(1300, 675 + d1, 'platform2');
            platform2.create(1500, 675 + d1, 'platform2');
            platform2.create(2300, 675 + d1, 'platform2');
            platform2.create(2500, 675 + d1, 'platform2');
            platform2.create(2700, 675 + d1, 'platform2');

            platform2.create(100, 675 + d2, 'platform2');
            platform2.create(1300, 675 + d2, 'platform2');
            platform2.create(1500, 675 + d2, 'platform2');
            platform2.create(2300, 675 + d2, 'platform2');
            platform2.create(2500, 675 + d2, 'platform2');
            platform2.create(2700, 675 + d2, 'platform2');

            platform2.create(100, 675 + d3, 'platform2');
            platform2.create(1300, 675 + d3, 'platform2');
            platform2.create(1500, 675 + d3, 'platform2');
            platform2.create(2300, 675 + d3, 'platform2');
            platform2.create(2500, 675 + d3, 'platform2');
            platform2.create(2700, 675 + d3, 'platform2');

            platform2.create(100, 675 + d4, 'platform2');
            platform2.create(150, 675 + d4, 'platform2');
            platform2.create(1250, 675 + d4, 'platform2');
            platform2.create(1300, 675 + d4, 'platform2');
            platform2.create(1500, 675 + d4, 'platform2');
            platform2.create(1550, 675 + d4, 'platform2');
            platform2.create(2250, 675 + d4, 'platform2');
            platform2.create(2300, 675 + d4, 'platform2');
            platform2.create(2500, 675 + d4, 'platform2');
            platform2.create(2700, 675 + d4, 'platform2');

            platform2.create(100, 675 + d5, 'platform2');
            platform2.create(300, 675 + d5, 'platform2');
            platform2.create(500, 675 + d5, 'platform2');
            platform2.create(700, 675 + d5, 'platform2');
            platform2.create(900, 675 + d5, 'platform2');
            platform2.create(1100, 675 + d5, 'platform2');
            platform2.create(1300, 675 + d5, 'platform2');
            platform2.create(1500, 675 + d5, 'platform2');
            platform2.create(1700, 675 + d5, 'platform2');
            platform2.create(1900, 675 + d5, 'platform2');
            platform2.create(2100, 675 + d5, 'platform2');
            platform2.create(2300, 675 + d5, 'platform2');
            platform2.create(2500, 675 + d5, 'platform2');
            platform2.create(2700, 675 + d5, 'platform2');
            platform2.create(2900, 675 + d5, 'platform2');
            //Spike
            gameState.Spike = this.physics.add.staticGroup();
            var d6 = 3;
            gameState.Spike.create(300, 675 - d6 + d4 + 5, 'spike').setScale(2);
            gameState.Spike.create(500, 675 - d6 + d4 +5, 'spike').setScale(2);
            gameState.Spike.create(700, 675 - d6 + d4 +5, 'spike').setScale(2);
            gameState.Spike.create(900, 675 - d6 + d4 +5, 'spike').setScale(2);
            gameState.Spike.create(1100, 675 - d6 + d4 +5, 'spike').setScale(2);
            gameState.Spike.create(225, 675 - d6 + d3 +5, 'spike').setScale(2);

            gameState.Spike.create(1192, 675 - d6, 'spike2').setScale(1);

            gameState.Spike.create(415, 575 + d1 + d6, 'spike4').setScale(3);
            gameState.Spike.create(615, 575 + d1 + d6, 'spike4').setScale(3);
            gameState.Spike.create(815, 575 + d1 + d6, 'spike4').setScale(3);
            gameState.Spike.create(985, 575 + d1 + d6, 'spike4').setScale(3);

            gameState.Spike.create(1900, 645, 'spike');
            //Bullet
            gameState.amountBullet = gameState.saveBullet;
            var Bullet = new Phaser.Class({

                Extends: Phaser.Physics.Arcade.Image,

            initialize:

            function Bullet(scene) {
                // Phaser.GameObjects.Image.call(this, scene, 0, 0, 'bullet');
                Phaser.Physics.Arcade.Image.call(this, scene, 0, 0, 'bullet');

                this.speed = Phaser.Math.GetSpeed(400, 1);
            },

            fire: function (x, y, type) {
                this.type = type;
                gameState.amountBullet -= 1;
                this.setPosition(x, y + 12);
                playerOldX = x;
                this.setActive(true);
                this.setVisible(true);
            },

            update: function (time, delta) {
                if (this.type === 'R') {
                    this.x += this.speed * delta;
                } else if (this.type === 'L') {
                    this.x -= this.speed * delta;
                }

                if (this.x > playerOldX + 300 || this.x < playerOldX - 300) {
                    this.setActive(false);
                    this.setVisible(false);
                    this.x = 100000;
                }
            }
            });

                gameState.bullets = this.physics.add.group({
                classType: Bullet,
                maxSize: 2,
                runChildUpdate: true
                });
                gameState.bullet = gameState.bullets.get();
                gameState.bullet.body.setAllowGravity(false);
            
            //Enemies
                //Bat
            gameState.bat1 = this.physics.add.sprite(300, 725, 'Bat');
            gameState.bat2 = this.physics.add.sprite(1100, 675, 'Bat');
            gameState.bat3 = this.physics.add.sprite(1975, 735, 'Bat');
            gameState.bat4 = this.physics.add.sprite(1975, 610, 'Bat');
            gameState.bat1.body.setAllowGravity(false);
            gameState.bat2.body.setAllowGravity(false);
            gameState.bat3.body.setAllowGravity(false);
            gameState.bat4.body.setAllowGravity(false);
            //Enemies Move
            var bat1Move = this.tweens.add({
                targets: gameState.bat1,
                x: 1100,
                duration: 2500,
                ease: 'Linear',
                repeat: -1,
                yoyo: true,
                onYoyo: function () {
                    gameState.bat1.flipX = true;
                },
                onRepeat: function () {
                    gameState.bat1.flipX = false;
                }
            });

            var bat2Move = this.tweens.add({
                targets: gameState.bat2,
                x: 300,
                duration: 2500,
                ease: 'Linear',
                repeat: -1,
                yoyo: true,
                onStart: function() {
                    gameState.bat2.flipX = true;
                },
                onYoyo: function () {
                    gameState.bat2.flipX = false;
                },
                onRepeat: function () {
                    gameState.bat2.flipX = true;
                }
            });

            var bat3Move = this.tweens.add({
                targets: [gameState.bat3 ,gameState.bat4],
                x: 1800,
                duration: 1500,
                ease: 'Linear',
                repeat: -1,
                yoyo: true,
                onStart: function() {
                    gameState.bat3.flipX = true;
                    gameState.bat4.flipX = true;
                },
                onYoyo: function () {
                    gameState.bat3.flipX = false;
                    gameState.bat4.flipX = false;
                },
                onRepeat: function () {
                    gameState.bat3.flipX = true;
                    gameState.bat4.flipX = true;
                }
            });
            //Enemies Die
            this.physics.add.overlap(gameState.bat1, gameState.bullets, () => {
                gameState.bat1.destroy();
            });
            this.physics.add.overlap(gameState.bat2, gameState.bullets, () => {
                gameState.bat2.destroy();
            });
            this.physics.add.overlap(gameState.bat3, gameState.bullets, () => {
                gameState.bat3.destroy();
            });
            this.physics.add.overlap(gameState.bat4, gameState.bullets, () => {
                gameState.bat4.destroy();
            });
            //Player
            gameState.player = this.physics.add.sprite(50, 600, 'dude');
            gameState.player.setBounce(0.2);

            this.cameras.main.startFollow(gameState.player, true, 0.5, 0.5);
            this.cameras.main.setBounds(0, 0, 3000, 800);

            gameState.player.setCollideWorldBounds(true);
            this.physics.world.setBounds(0, 0, 3000, 800);

            this.physics.add.collider(platform, gameState.player);
            this.physics.add.collider(platform2, gameState.player);

            this.physics.add.overlap(gameState.player, gameState.Spike, () => {
                this.add.text(gameState.player.x + 10, gameState.player.y - 40, 'Game Over...\n  Click to play again.', {
                    fontFamily: 'Arial',
                    fontSize: 36,
                    color: '#f00ff0'
                });
                gameState.player.setTint('0xff0000')
                this.physics.pause();
                this.anims.pauseAll();
                this.input.on('pointerup', () => {
                    this.scene.restart();
                    this.anims.resumeAll();
                    keyMove = 1;
                    gameState.amountBullet = ammo;
                });
                keyMove = 0;
            });
            this.physics.add.overlap(gameState.player, gameState.bat1, () => {
                this.add.text(gameState.player.x + 10, gameState.player.y - 40, 'Game Over...\n  Click to play again.', {
                    fontFamily: 'Arial',
                    fontSize: 36,
                    color: '#f00ff0'
                });
                gameState.player.setTint('0xff0000')
                this.physics.pause();
                this.anims.pauseAll();
                this.input.on('pointerup', () => {
                    this.scene.restart();
                    this.anims.resumeAll();
                    keyMove = 1;
                    gameState.amountBullet = ammo;
                });
                keyMove = 0;
            });
            this.physics.add.overlap(gameState.player, gameState.bat2, () => {
                this.add.text(gameState.player.x + 10, gameState.player.y - 40, 'Game Over...\n  Click to play again.', {
                    fontFamily: 'Arial',
                    fontSize: 36,
                    color: '#f00ff0'
                });
                gameState.player.setTint('0xff0000')
                this.physics.pause();
                this.anims.pauseAll();
                this.input.on('pointerup', () => {
                    this.scene.restart();
                    this.anims.resumeAll();
                    keyMove = 1;
                    gameState.amountBullet = ammo;
                });
                keyMove = 0;
            });
            this.physics.add.overlap(gameState.player, gameState.bat3, () => {
                this.add.text(gameState.player.x + 10, gameState.player.y - 40, 'Game Over...\n  Click to play again.', {
                    fontFamily: 'Arial',
                    fontSize: 36,
                    color: '#f00ff0'
                });
                gameState.player.setTint('0xff0000')
                this.physics.pause();
                this.anims.pauseAll();
                this.input.on('pointerup', () => {
                    this.scene.restart();
                    this.anims.resumeAll();
                    keyMove = 1;
                    gameState.amountBullet = ammo;
                });
                keyMove = 0;
            });
            this.physics.add.overlap(gameState.player, gameState.bat4, () => {
                this.add.text(gameState.player.x + 10, gameState.player.y - 40, 'Game Over...\n  Click to play again.', {
                    fontFamily: 'Arial',
                    fontSize: 36,
                    color: '#f00ff0'
                });
                gameState.player.setTint('0xff0000')
                this.physics.pause();
                this.anims.pauseAll();
                this.input.on('pointerup', () => {
                    this.scene.restart();
                    this.anims.resumeAll();
                    keyMove = 1;
                    gameState.amountBullet = ammo;
                });
                keyMove = 0;
            });
            //Animations
            this.anims.create({
                key: 'move',
                frames: this.anims.generateFrameNumbers('dude', {
                    start: 0,
                    end: 3
                }),
                frameRate: 10,
                repeat: -1
            });

            this.anims.create({
                key: 'idle',
                frames: [{
                    key: 'dude',
                    frame: 4
                }],
                frameRate: 20
            });

            this.anims.create({
                key: 'moveBat',
                frames: this.anims.generateFrameNumbers('Bat', {
                    start: 0,
                    end: 7
                }),
                frameRate: 10,
                repeat: -1
            });
            gameState.bat1.anims.play('moveBat', true);
            gameState.bat2.anims.play('moveBat', true);
            gameState.bat3.anims.play('moveBat', true);
            gameState.bat4.anims.play('moveBat', true);
            //Ammo
            let ammos1 = this.physics.add.sprite(1400, 675 - 64, 'ammo');
            ammos1.body.setAllowGravity(false);

            this.physics.add.collider(gameState.player, ammos1, () => {
                ammos1.destroy();
                gameState.amountBullet += 6;
            });
            //End Point
            let endPoint = this.physics.add.sprite(2900 + 18, 675 + 74, 'endpoint');
            endPoint.body.setAllowGravity(false);

            this.physics.add.overlap(gameState.player, endPoint, () => {
                this.add.text(gameState.player.x - 400, gameState.player.y - 40, 'Win Game...\n  Click to Continue.', {
                    fontFamily: 'Arial',
                    fontSize: 36,
                    color: '#f00ff0'
                });
                gameState.player.setTint('0xff0000');
                this.physics.pause();
                gameState.player.setTint('0x2FFF00');
                gameState.saveBullet = gameState.amountBullet;
                this.input.on('pointerdown', () => {
			        this.scene.stop('Level2')
			        this.scene.start('Level3')
		        })
            });
        }
        
        update(time) {
            var cursors = this.input.keyboard.createCursorKeys();
            if (keyMove === 1) {
                if (cursors.left.isDown) {
                    gameState.player.setVelocityX(-200);
                    gameState.player.anims.play('move', true);
                    gameState.player.flipX = false;
                } else if (cursors.right.isDown) {
                    gameState.player.setVelocityX(200);
                    gameState.player.anims.play('move', true);
                    gameState.player.flipX = true;
                } else {
                    gameState.player.setVelocityX(0);
                    gameState.player.anims.play('idle', true);
                }

                // Jump
                if (cursors.up.isDown && gameState.player.body.touching.down) {
                    gameState.player.setVelocityY(-500);
                }

                // Shoot
                if (cursors.space.isDown && time > lastFired && cursors.right.isDown && gameState.amountBullet > 0) {
                    
                    gameState.bullet = gameState.bullets.get();

                    if (gameState.bullet !== null) {
                        gameState.bullet.body.setAllowGravity(false);

                        if (gameState.bullet) {
                            gameState.bullet.fire(gameState.player.x, gameState.player.y, 'R');

                            lastFired = time + 50;
                        }
                    };
                };

                if (cursors.space.isDown && time > lastFired && cursors.left.isDown && gameState.amountBullet > 0) {
                    
                    gameState.bullet = gameState.bullets.get();

                    if (gameState.bullet !== null) {
                        gameState.bullet.body.setAllowGravity(false);

                        if (gameState.bullet) {
                            gameState.bullet.fire(gameState.player.x, gameState.player.y, 'L');

                            lastFired = time + 50;
                        }
                    };
                };

            }
        }
    }
    class Level3 extends Phaser.Scene {
        constructor() { 
            super({ key: 'Level3' })
        }
        preload() {  
            this.load.spritesheet('dude', 'dude.png', {
                frameWidth: 32,
                frameHeight: 48
            });
            this.load.spritesheet('slime', 'topdown_shooter/topdown_shooter/monster/slime1_front.png', {
                frameWidth: 16,
                frameHeight: 16
            });
            this.load.image('platform', 'https://s3.amazonaws.com/codecademy-content/courses/learn-phaser/Cave+Crisis/platform.png');
            this.load.image('platform2', 'platform2.png');
            this.load.image('bullet', 'topdown_shooter/topdown_shooter/other/bulletc.png');
            this.load.image('spike', 'Spike.png');
            this.load.image('spike2', 'Spike2.png');
            this.load.image('spike3', 'Spike3.png');
            this.load.image('spike4', 'Spike4.png');
            this.load.image('endpoint', 'End.png');
            this.load.image('ammo', 'ammo.png');
            this.load.image('sawoff','OffSaw.png');
            this.load.spritesheet('sawon','OnSaw.png', {
                frameWidth: 38,
                frameHeight: 38,
            });
            this.load.spritesheet('bat', 'Flight.png', {
                frameWidth: 50,
                frameHeight: 37
            });
            this.load.image('mountain', 'Glacial-mountains-parallax-background_vnitti_v3/Glacial-mountains-parallax-background_vnitti/Layers/glacial_mountains_lightened.png');
            this.load.image('snow','snowflake.png');
            this.load.image('sky', 'Final/Assets/Background_2.png');
            this.load.image('boss','Boss1.png');
            this.load.image('bulletBoss','cannonball.png');
            this.load.image('button', 'Button.png');
            this.load.spritesheet('blood', 'blood.png', {
                frameWidth: 300,
                frameHeight: 20,
            });
        }
        create() {
            //BackGround
            this.add.image(-500, 0, 'sky').setOrigin(0, 0).setScale(7);
            this.add.image(-500, -400, 'mountain').setOrigin(0, 0).setScale(8);

            //Plate
            const platform = this.physics.add.staticGroup();

            platform.create(-500, 775, 'platform');
            platform.create(-300, 775, 'platform');
            platform.create(-100, 775, 'platform');
            platform.create(100, 775, 'platform');
            platform.create(300, 775, 'platform');
            platform.create(500, 775, 'platform');
            platform.create(700, 775, 'platform');
            platform.create(900, 775, 'platform');
            platform.create(1100, 775, 'platform');
            platform.create(1300, 775, 'platform');
            platform.create(1500, 775, 'platform');
            platform.create(1700, 775, 'platform');
            platform.create(1900, 775, 'platform');
            platform.create(2100, 775, 'platform');
            platform.create(2300, 775, 'platform');
            platform.create(2500, 775, 'platform');

            platform.create(1000, 775 - 100, 'platform');
            platform.create(1300, 775 - 200, 'platform');
            platform.create(700, 775 - 200, 'platform');
            platform.create(1500, 775 - 300, 'platform');
            platform.create(500, 775 - 300, 'platform');
            platform.create(200, 775 - 300, 'platform');
            platform.create(1800, 775 - 300, 'platform');

            platform.create(1000, 775 - 300, 'platform');
            platform.create(1300, 775 - 400, 'platform');
            platform.create(700, 775 - 400, 'platform');
            platform.create(1000, 775 - 460, 'platform');

            platform.create(-100, 775 - 200, 'platform');
            platform.create(-400, 775 - 300, 'platform');
            platform.create(2100, 775 - 200, 'platform');
            platform.create(2400, 775 - 300, 'platform');
            //Spike
            const spike = this.physics.add.staticGroup();
            
            spike.create(2350, 775 - 300 - 36, 'spike').setScale(3);
            spike.create(175, 775 - 300 - 36, 'spike').setScale(3);
            spike.create(475, 775 - 300 - 36, 'spike').setScale(3);
            spike.create(1800, 775 - 300 - 36, 'spike').setScale(3);
            spike.create(650, 775 - 425 - 12, 'spike').setScale(3);
            spike.create(1000, 775 - 125 - 12,  'spike').setScale(3);
            spike.create(1000, 775 - 325 - 8, 'spike').setScale(2);
            spike.create(1300, 775 - 225 - 12, 'spike').setScale(3);
            spike.create(1300, 775 - 425 - 12, 'spike').setScale(3);
            spike.create(2100, 775 - 200 - 36, 'spike').setScale(3);
            spike.create(-100, 775 - 200 - 36, 'spike').setScale(3);

            spike.create(900 + 15, 775 - 460 + 32, 'spike4').setScale(2);
            spike.create(1100 - 15, 775 - 460 + 32, 'spike4').setScale(2);

            spike.create(600 + 10, 775 - 300,'spike3').setScale(3);

            //Player
            gameState.player = this.physics.add.sprite(1000, 775 - 50,'dude');
            gameState.player.setBounce(0.2);

            this.cameras.main.startFollow(gameState.player, true, 0.5, 0.5);
            this.cameras.main.setBounds(-500, 0, 3000, 800);

            gameState.player.setCollideWorldBounds(true);
            this.physics.world.setBounds(-500, 0, 3000, 800);

            this.physics.add.collider(platform, gameState.player);
            //Boss
            gameState.boss = this.physics.add.sprite(1025, 775 - 620, 'boss').setScale(5);
            gameState.boss.body.setAllowGravity(false);

            gameState.skillBoss1 = Math.floor(Math.random() * 2)+1;
            
            //Bullet
            gameState.amountBullet = gameState.saveBullet;
            var Bullet = new Phaser.Class({

                Extends: Phaser.Physics.Arcade.Image,

            initialize:

            function Bullet(scene) {
                // Phaser.GameObjects.Image.call(this, scene, 0, 0, 'bullet');
                Phaser.Physics.Arcade.Image.call(this, scene, 0, 0, 'bullet');

                this.speed = Phaser.Math.GetSpeed(400, 1);
            },

            fire: function (x, y, type) {
                this.type = type;
                gameState.amountBullet -= 1;
                this.setPosition(x, y + 12);
                playerOldX = x;
                this.setActive(true);
                this.setVisible(true);
            },

            update: function (time, delta) {
                if (this.type === 'R') {
                    this.x += this.speed * delta;
                } else if (this.type === 'L') {
                    this.x -= this.speed * delta;
                }

                if (this.x > playerOldX + 300 || this.x < playerOldX - 300) {
                    this.setActive(false);
                    this.setVisible(false);
                    this.x = 100000;
                }
            }
            });

                gameState.bullets = this.physics.add.group({
                classType: Bullet,
                maxSize: 2,
                runChildUpdate: true
                });
                gameState.bullet = gameState.bullets.get();
                gameState.bullet.body.setAllowGravity(false);
            //Bullet Boss
            var BulletBoss = new Phaser.Class({

                Extends: Phaser.Physics.Arcade.Image,

            initialize:

            function BulletBoss(scene) {
                // Phaser.GameObjects.Image.call(this, scene, 0, 0, 'bullet');
                Phaser.Physics.Arcade.Image.call(this, scene, 0, 0, 'bulletBoss');

                this.speed = Phaser.Math.GetSpeed(400, 1);
            },

            fire: function (x, y, type) {
                this.type = type;
                this.setPosition(x, y + 30);
                bossOldX = x;
                bossOldY = y;
                this.setActive(true);
                this.setVisible(true);
            },

            update: function (time, delta) {
                if (this.type === 1) {
                    this.x += this.speed * delta;
                    this.y += this.speed * delta;
                } else if (this.type === 2) {
                    this.x -= this.speed * delta;
                    this.y += this.speed * delta;
                } else if (this.type === 3) {
                    this.x += this.speed * delta;
                    this.y += (this.speed * delta) + 6;
                } else if (this.type === 4) {
                    this.x -= this.speed * delta;
                    this.y += (this.speed * delta) + 6;
                } else if (this.type === 5) {
                    this.y += (this.speed * delta) + 8;
                } else if (this.type === 6) {
                    this.x += this.speed * delta;
                    this.y += (this.speed * delta) - 4;
                } else if (this.type === 7) {
                    this.x -= this.speed * delta;
                    this.y += (this.speed * delta) - 4;
                }
                

                if (this.x > bossOldX + 1400 || this.x < bossOldX - 1400 || this.y > bossOldY + 1400 || this.y < bossOldY - 1400) {
                    this.setActive(false);
                    this.setVisible(false);
                    this.x = 100000;
                }
            }
            });
            gameState.bulletsBoss = this.physics.add.group({
                classType: BulletBoss,
                maxSize: 20,
                runChildUpdate: true
            });
            gameState.bulletBoss = gameState.bulletsBoss.get();
            gameState.bulletBoss.body.setAllowGravity(false);
            //Ammo
            gameState.ammos1 = this.physics.add.sprite(700, 775 - 275, 'ammo');
            gameState.ammos1.body.setAllowGravity(false);

            gameState.ammos2 = this.physics.add.sprite(1000, 775 - 400, 'ammo');
            gameState.ammos2.body.setAllowGravity(false);

            gameState.ammos3 = this.physics.add.sprite(-100, 775 - 275, 'ammo');
            gameState.ammos3.body.setAllowGravity(false);

            //Button to kill Boss
            gameState.button1 = this.physics.add.sprite(1000, 775 - 490, 'button');
            gameState.button1.body.setAllowGravity(false);

            gameState.button2 = this.physics.add.sprite(-100, 775 - 32, 'button');
            gameState.button2.body.setAllowGravity(false);

            gameState.button3 = this.physics.add.sprite(-400, 775 - 32 - 300, 'button');
            gameState.button3.body.setAllowGravity(false);

            gameState.button4 = this.physics.add.sprite(2450, 775 - 32 - 300, 'button');
            gameState.button4.body.setAllowGravity(false);

            //Boss Health
            gameState.bossHealth = this.physics.add.sprite(1000, 250, 'blood');
            gameState.bossHealth.body.setAllowGravity(false);

            gameState.healthboss = 100;
            //Enemies
            gameState.bat1 = this.physics.add.sprite(-425, 775 - 360, 'bat');
            gameState.bat1.body.setAllowGravity(false);

            gameState.slime1 = this.physics.add.sprite(625, 775 - 200 - 50, 'slime').setScale(3);
            gameState.slime1.body.setAllowGravity(false); 

            gameState.slime2 = this.physics.add.sprite(2025, 775 - 200 - 50, 'slime').setScale(3);
            gameState.slime2.body.setAllowGravity(false); 
            //Bat move
            var bat1Move = this.tweens.add({
                targets: gameState.bat1,
                x: 300,
                duration: 2500,
                ease: 'Linear',
                repeat: -1,
                yoyo: true,
                onYoyo: function () {
                    gameState.bat1.flipX = true;
                },
                onRepeat: function () {
                    gameState.bat1.flipX = false;
                }
            });
            //Slime move
            var slime1Move = this.tweens.add({
                targets: gameState.slime1,
                x: gameState.slime1.x + 160,
                duration: 2500,
                ease: 'Linear',
                repeat: -1,
                yoyo: true,
                onYoyo: function () {
                    gameState.slime1.flipX = true;
                },
                onRepeat: function () {
                    gameState.slime1.flipX = false;
                }
            });

            var slime2Move = this.tweens.add({
                targets: gameState.slime2,
                x: gameState.slime2.x + 160,
                duration: 2000,
                ease: 'Linear',
                repeat: -1,
                yoyo: true,
                onYoyo: function () {
                    gameState.slime2.flipX = true;
                },
                onRepeat: function () {
                    gameState.slime2.flipX = false;
                }
            });

            //Player touch boss
            this.physics.add.overlap(gameState.player, gameState.boss, () => {
                this.add.text(gameState.player.x + 10, gameState.player.y - 40, 'Game Over...\n  Click to play again.', {
                    fontFamily: 'Arial',
                    fontSize: 36,
                    color: '#f00ff0'
                });
                gameState.player.setTint('0xff0000')
                this.physics.pause();
                this.anims.pauseAll();
                this.input.on('pointerup', () => {
                    this.scene.restart();
                    this.anims.resumeAll();
                    keyMove = 1;
                    gameState.amountBullet = ammo;
                    gameState.skillBoss1 = Math.floor(Math.random() * 2)+1;
                    gameState.keyBoss1 = 1;
                });
                keyMove = 0;
            });
            //Player touch boss bullet
            this.physics.add.overlap(gameState.player, gameState.bulletsBoss, () => {
                this.add.text(gameState.player.x + 10, gameState.player.y - 40, 'Game Over...\n  Click to play again.', {
                    fontFamily: 'Arial',
                    fontSize: 36,
                    color: '#f00ff0'
                });
                gameState.player.setTint('0xff0000')
                this.physics.pause();
                this.anims.pauseAll();
                this.input.on('pointerup', () => {
                    this.scene.restart();
                    this.anims.resumeAll();
                    keyMove = 1;
                    gameState.amountBullet = ammo;
                    gameState.skillBoss1 = Math.floor(Math.random() * 2)+1;
                    gameState.keyBoss1 = 1;
                });
                keyMove = 0;
            });
            //Player touch button to kill Boss
            this.physics.add.overlap(gameState.player, gameState.button1, () => {
                gameState.button1.destroy();
                gameState.healthboss -= 25;
            });
            this.physics.add.overlap(gameState.player, gameState.button2, () => {
                gameState.button2.destroy();
                gameState.healthboss -= 25;
            });
            this.physics.add.overlap(gameState.player, gameState.button3, () => {
                gameState.button3.destroy();
                gameState.healthboss -= 25;
            });
            this.physics.add.overlap(gameState.player, gameState.button4, () => {
                gameState.button4.destroy();
                gameState.healthboss -= 25;
            });
            //Player touch enemies
            this.physics.add.overlap(gameState.player, gameState.bat1, () => {
                this.add.text(gameState.player.x + 10, gameState.player.y - 40, 'Game Over...\n  Click to play again.', {
                    fontFamily: 'Arial',
                    fontSize: 36,
                    color: '#f00ff0'
                });
                gameState.player.setTint('0xff0000')
                this.physics.pause();
                this.anims.pauseAll();
                this.input.on('pointerup', () => {
                    this.scene.restart();
                    this.anims.resumeAll();
                    keyMove = 1;
                    gameState.amountBullet = ammo;
                    gameState.skillBoss1 = Math.floor(Math.random() * 2)+1;
                    gameState.keyBoss1 = 1;
                });
                keyMove = 0;
            });

            this.physics.add.overlap(gameState.player, gameState.slime1, () => {
                this.add.text(gameState.player.x + 10, gameState.player.y - 40, 'Game Over...\n  Click to play again.', {
                    fontFamily: 'Arial',
                    fontSize: 36,
                    color: '#f00ff0'
                });
                gameState.player.setTint('0xff0000')
                this.physics.pause();
                this.anims.pauseAll();
                this.input.on('pointerup', () => {
                    this.scene.restart();
                    this.anims.resumeAll();
                    keyMove = 1;
                    gameState.amountBullet = ammo;
                    gameState.skillBoss1 = Math.floor(Math.random() * 2)+1;
                    gameState.keyBoss1 = 1;
                });
                keyMove = 0;
            });

            this.physics.add.overlap(gameState.player, gameState.slime2, () => {
                this.add.text(gameState.player.x + 10, gameState.player.y - 40, 'Game Over...\n  Click to play again.', {
                    fontFamily: 'Arial',
                    fontSize: 36,
                    color: '#f00ff0'
                });
                gameState.player.setTint('0xff0000')
                this.physics.pause();
                this.anims.pauseAll();
                this.input.on('pointerup', () => {
                    this.scene.restart();
                    this.anims.resumeAll();
                    keyMove = 1;
                    gameState.amountBullet = ammo;
                    gameState.skillBoss1 = Math.floor(Math.random() * 2)+1;
                    gameState.keyBoss1 = 1;
                });
                keyMove = 0;
            });
            //Player touch ammo
            this.physics.add.overlap(gameState.player, gameState.ammos1, () => {
                gameState.amountBullet += 3;
                gameState.ammos1.destroy();
            });
            this.physics.add.overlap(gameState.player, gameState.ammos2, () => {
                gameState.amountBullet += 3;
                gameState.ammos2.destroy();
            });
            this.physics.add.overlap(gameState.player, gameState.ammos3, () => {
                gameState.amountBullet += 3;
                gameState.ammos3.destroy();
            });
            //Player touch spike
            this.physics.add.overlap(gameState.player, spike, () => {
                this.add.text(gameState.player.x + 10, gameState.player.y - 40, 'Game Over...\n  Click to play again.', {
                    fontFamily: 'Arial',
                    fontSize: 36,
                    color: '#f00ff0'
                });
                gameState.player.setTint('0xff0000')
                this.physics.pause();
                this.anims.pauseAll();
                this.input.on('pointerup', () => {
                    this.scene.restart();
                    this.anims.resumeAll();
                    keyMove = 1;
                    gameState.amountBullet = ammo;
                    gameState.skillBoss1 = Math.floor(Math.random() * 2)+1;
                    gameState.keyBoss1 = 1;
                });
                keyMove = 0;
            });
            
            //Enemies touch player`s bullet
            this.physics.add.overlap(gameState.bat1, gameState.bullets, () => {
                gameState.bat1.destroy();
            });

            this.physics.add.overlap(gameState.slime1, gameState.bullets, () => {
                gameState.slime1.destroy();
            });

            this.physics.add.overlap(gameState.slime2, gameState.bullets, () => {
                gameState.slime2.destroy();
            });
            
            //Animation
            this.anims.create({
                key: 'move',
                frames: this.anims.generateFrameNumbers('dude', {
                    start: 0,
                    end: 3
                }),
                frameRate: 10,
                repeat: -1
            });

            this.anims.create({
                key: 'idle',
                frames: [{
                    key: 'dude',
                    frame: 4
                }],
                frameRate: 20
            });

            this.anims.create({
                key: 'moveBat',
                frames: this.anims.generateFrameNumbers('bat', {
                    start: 0,
                    end: 7
                }),
                frameRate: 10,
                repeat: -1
            });
            this.anims.create({
                key: 'moveSlime',
                frames: this.anims.generateFrameNumbers('slime', {
                    start: 0,
                    end: 3
                }),
                frameRate: 10,
                repeat: -1
            });

            this.anims.create({
                key: 'health2',
                frames: [{
                    key: 'blood',
                    frame: 1
                }],
                frameRate: 20
            });

            this.anims.create({
                key: 'health3',
                frames: [{
                    key: 'blood',
                    frame: 2
                }],
                frameRate: 20
            });

            this.anims.create({
                key: 'health4',
                frames: [{
                    key: 'blood',
                    frame: 3
                }],
                frameRate: 20
            });
            this.anims.create({
                key: 'health5',
                frames: [{
                    key: 'blood',
                    frame: 4
                }],
                frameRate: 20
            });
            gameState.bat1.anims.play('moveBat', true);
            gameState.slime2.anims.play('moveSlime', true);
            gameState.slime1.anims.play('moveSlime', true);
        }

        update(time) {
            var cursors = this.input.keyboard.createCursorKeys();
            if (keyMove === 1) {
                if (cursors.left.isDown) {
                    gameState.player.setVelocityX(-200);
                    gameState.player.anims.play('move', true);
                    gameState.player.flipX = false;
                } else if (cursors.right.isDown) {
                    gameState.player.setVelocityX(200);
                    gameState.player.anims.play('move', true);
                    gameState.player.flipX = true;
                } else {
                    gameState.player.setVelocityX(0);
                    gameState.player.anims.play('idle', true);
                }

                // Jump
                if (cursors.up.isDown && gameState.player.body.touching.down) {
                    gameState.player.setVelocityY(-500);
                }

                // Shoot
                if (cursors.space.isDown && time > lastFired && cursors.right.isDown && gameState.amountBullet > 0) {
                    
                    gameState.bullet = gameState.bullets.get();

                    if (gameState.bullet !== null) {
                        gameState.bullet.body.setAllowGravity(false);

                        if (gameState.bullet) {
                            gameState.bullet.fire(gameState.player.x, gameState.player.y, 'R');

                            lastFired = time + 50;
                        }
                    };
                };

                if (cursors.space.isDown && time > lastFired && cursors.left.isDown && gameState.amountBullet > 0) {
                    
                    gameState.bullet = gameState.bullets.get();

                    if (gameState.bullet !== null) {
                        gameState.bullet.body.setAllowGravity(false);

                        if (gameState.bullet) {
                            gameState.bullet.fire(gameState.player.x, gameState.player.y, 'L');

                            lastFired = time + 50;
                        }
                    };
                };
            }
            var timeBossMove = 4000;
            var amountBulletBoss = 7;
            if (gameState.skillBoss1 == 1 && gameState.keyBoss1 == 1) {
            gameState.boss1Move = this.tweens.add({
                targets: gameState.boss,
                x: gameState.boss.x - 1200,
                duration: timeBossMove,
                ease: 'Linear',
                repeat: 0,
                yoyo: true,
                onComplete: function () {
                    gameState.skillBoss1 = Math.floor(Math.random() * 2)+1;
                    gameState.keyBoss1 = 1;
                    for (i = 1; i <= amountBulletBoss; i++) {
                        gameState.bulletBoss = gameState.bulletsBoss.get();
                        gameState.bulletBoss.body.setAllowGravity(false);
                        gameState.bulletBoss.fire(gameState.boss.x, gameState.boss.y, i);
                    }
                },
                onYoyo: function () {
                    for (i = 1; i <= amountBulletBoss; i++) {
                        gameState.bulletBoss = gameState.bulletsBoss.get();
                        gameState.bulletBoss.body.setAllowGravity(false);
                        gameState.bulletBoss.fire(gameState.boss.x, gameState.boss.y, i);
                    }
                }
            });
            gameState.keyBoss1 = 0;
            }
            if (gameState.skillBoss1 == 2 && gameState.keyBoss1 == 1) {
            gameState.boss1Move = this.tweens.add({
                targets: gameState.boss,
                x: gameState.boss.x + 1200,
                duration: timeBossMove,
                ease: 'Linear',
                repeat: 0,
                yoyo: true,
                onComplete: function () {
                    gameState.skillBoss1 = Math.floor(Math.random() * 2)+1;
                    gameState.keyBoss1 = 1;
                    for (i = 1; i <= amountBulletBoss; i++) {
                        gameState.bulletBoss = gameState.bulletsBoss.get();
                        gameState.bulletBoss.body.setAllowGravity(false);
                        gameState.bulletBoss.fire(gameState.boss.x, gameState.boss.y, i);
                    }
                },
                onYoyo: function () {
                    for (i = 1; i <= amountBulletBoss; i++) {
                        gameState.bulletBoss = gameState.bulletsBoss.get();
                        gameState.bulletBoss.body.setAllowGravity(false);
                        gameState.bulletBoss.fire(gameState.boss.x, gameState.boss.y, i);
                    }
                }
            });
            gameState.keyBoss1 = 0;
            }
            //Health of Boss
            if (gameState.healthboss == 75) {
                gameState.bossHealth.anims.play('health2', true);
            }
            if (gameState.healthboss == 50) {
                gameState.bossHealth.anims.play('health3', true);
                gameState.boss.setTint('0x00FFDC');
            }
            if (gameState.healthboss == 25) {
                gameState.bossHealth.anims.play('health4', true);
            }
            if (gameState.healthboss == 0) {
                gameState.bossHealth.anims.play('health5', true);
                gameState.boss.destroy();
                gameState.boss1Move.pause();
                
            }
        }
    }
    
        var config = {
            type: Phaser.AUTO,
            width: 1000,
            height: 600,
            backgroundColor: "#050505",
            physics: {
                default: 'arcade',
                arcade: {
                    gravity: {
                        y: 1000
                    },
                    enableBody: true,
                }
            },
            scene: [Level1, Level2, Level3, Inventory],
        };

        var game = new Phaser.Game(config);
    </script>

</body>

</html>